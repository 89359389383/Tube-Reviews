<!-- app/views/videos/show.html.erb -->

<!-- バリデーションエラーメッセージの表示 -->
<% if @video.errors.any? %>
  <div id="error_explanation">
    <h2><%= pluralize(@video.errors.count, "error") %> prohibited this vide
o from being saved:</h2>

    <ul>
    <% @video.errors.full_messages.each do |message| %>
      <li><%= message %></li>
    <% end %>
    </ul>
  </div>
<% end %> 

<!-- 動画のタイトルを表示 -->
<h1><%= @video_details.title || @video.title %></h1>

<!-- 動画の埋め込み表示 -->
<iframe width="560" height="315" src="https://www.youtube.com/embed/<%= @video_details.video_id %>" frameborder="0" allowfullscreen></iframe> 

<!-- シェアボタンの表示 -->
<%= social_share_button_tag('Share to social networks') %>
<p>シェア機能を利用するためには、ポップアップを許可してください。</p 

<!-- おすすめの動画の表示 -->
<div class="recommended-videos">
  <h3>おすすめの動画</h3>
  <ul>
    <% @recommended_videos.each do |video| %>
      <li class="recommended-video-item">
        <div class="recommended-thumbnail">
          <%= link_to image_tag("https://img.youtube.com/vi/#{video.video_id}/0.jpg", alt: video.title, class: "recommended-thumbnail-image"), video_path(video) %>
        </div>
        <div class="recommended-video-info">
          <p><%= link_to video.title, video_path(video) %></p>
        </div>
      </li>
    <% end %>
  </ul>
</div>

<!-- 感想入力フォームの直前にエラーメッセージを表示 -->
<% if @review&.errors&.any? %>
  <ul>
    <% @review.errors.full_messages.each do |message| %>
      <li><%= message %></li>
    <% end %>
  </ul>
<% end %>

<!-- 感想入力フォームの追加 -->
<h2>あなたの感想</h2>
<%= form_for [@video, Review.new], data: { turbo: "false" } do |f| %>
  <%= f.hidden_field :video_id, value: @video.id %>
  <%= f.text_area :body, rows: 5, placeholder: "ここに感想を入力してくださ
い" %> 
 <div class="submit-button">
    <%= f.submit "感想を投稿する", class: "btn btn-primary" %>
  </div>
<% end %> 

<!-- 感想の一覧表示 -->
<h2><%= link_to '感想一覧', reviews_path %></h2>
<% @reviews.each do |review| %>
  <div class="review">
    <p><%= review.body %></p>
    <% if current_user == review.user %>
      <p>
        <%= link_to 'Edit', edit_video_review_path(@video, review) %> |
      </p>
    <% end %>
    <small>Posted on <%= review.created_at.strftime('%Y-%m-%d %H:%M:%S') %></small> 
 </div>
<% end %> 

<!-- 動画一覧ページへ戻るリンクを表示 -->
<p>
  <%= link_to 'Back to All Videos', videos_path %>
</p> 